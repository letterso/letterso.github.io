---
layout:     post
title:       "è°ƒè¯•"
subtitle:    ""
description: "linuxç¯å¢ƒä¸‹c++è°ƒè¯•ç›¸å…³å†…å®¹"
date:        2025-11-21
author: Â  Â   "LETTER"
image:       ""
publishDate: 2025-11-21
tags:
    - C++
    - ç³»ç»Ÿ
categories:  ["Tech" ]
---

# GDB

GDBï¼ˆGNU Debuggerï¼‰æ˜¯UNIXåŠUNIX-likeä¸‹çš„å¼ºå¤§è°ƒè¯•å·¥å…·ï¼Œå¯ä»¥è°ƒè¯•ada, c, c++, asm, minimal, d, fortran, objective-c, go, java,pascalç­‰è¯­è¨€ã€‚

## GDBå¸¸ç”¨å‘½ä»¤

### åŸºæœ¬

| å‘½ä»¤      | æè¿°                              |
| --------- | --------------------------------- |
| gdb       | æ‰“å¼€è°ƒè¯•å™¨                        |
| file FILE | è£…è½½æŒ‡å®šå¯æ‰§è¡Œæ–‡ä»¶                |
| r         | ä»£è¡¨runï¼Œä»å¤´å¼€å§‹è¿è¡Œç¨‹åºç›´åˆ°æ–­ç‚¹ |
| q         | é€€å‡ºdebug                         |
| bt        | åˆ—å‡ºè°ƒç”¨å †æ ˆ                      |

### æ˜¾ç¤ºè¢«è°ƒè¯•æ–‡ä»¶ä¿¡æ¯

| å‘½ä»¤       | æè¿°                         |
| ---------- | ---------------------------- |
| info files | æ˜¾ç¤ºè¢«è°ƒè¯•æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯     |
| info func  | æ˜¾ç¤ºæ‰€æœ‰å‡½æ•°åç§°             |
| info local | æ˜¾ç¤ºå½“å‰å‡½æ•°ä¸­çš„å±€éƒ¨å˜é‡ä¿¡æ¯ |
| info prog  | æ˜¾ç¤ºè¢«è°ƒè¯•ç¨‹åºçš„æ‰§è¡ŒçŠ¶æ€     |
| info var   | æ˜¾ç¤ºæ‰€æœ‰çš„å…¨å±€å’Œé™æ€å˜é‡åç§° |

### æŸ¥çœ‹/ä¿®æ”¹å†…å­˜

| å‘½ä»¤                 | æè¿°                                                         |
| -------------------- | ------------------------------------------------------------ |
| p x                  | ç›¸å½“äºâ€œprint xâ€ã€‚æ˜¾ç¤ºå½“å‰å˜é‡ x çš„å€¼                         |
| display x            | å’Œprintçš„åŒºåˆ«æ˜¯ï¼Œxä¸æ˜¯åªæ˜¾ç¤ºä¸€æ¬¡å°±æ¶ˆå¤±ï¼Œè€Œæ˜¯ä¸€ç›´æ˜¾ç¤ºï¼Œæ¯æ¬¡ç»§ç»­è¿è¡Œç¨‹åºéƒ½ä¼šåˆ·æ–°ã€‚ç›¸å½“äºVSçš„â€œwatchâ€åŠŸèƒ½ |
| undisplay x          | åœæ­¢å¯¹å˜é‡xçš„display                                         |
| x address            | æŸ¥çœ‹æŒ‡é’ˆæ‰€æŒ‡ä½ç½®çš„å€¼                                         |
| set x = 12 set x = y | ä¿®æ”¹å˜é‡xçš„å€¼                                                |
| call function()      | è°ƒç”¨æŸå‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°å¯ä»¥æ˜¯ä½ ç¨‹åºé‡Œå®šä¹‰çš„å‡½æ•°ï¼Œç”šè‡³æ˜¯æ ‡å‡†åº“å‡½æ•°ï¼Œæˆ‘çš„ç†è§£æ˜¯åªè¦åœ¨å½“å‰ä½ç½®å¯è®¿é—®åˆ°çš„å‡½æ•°éƒ½å¯ä»¥è°ƒç”¨ã€‚ |

### æ–­ç‚¹

| å‘½ä»¤           | æè¿°                                                         |
| -------------- | ------------------------------------------------------------ |
| b              | bå³breakã€‚åœ¨å½“å‰è¡Œè®¾ç½®æ–­ç‚¹ã€‚                                 |
| b 45           | åœ¨æŸè¡Œè®¾ç½®æ–­ç‚¹ã€‚                                             |
| b functionName | åœ¨æŸå‡½æ•°å¼€å§‹å¤„è®¾ç½®æ–­ç‚¹ã€‚å¸¸ç”¨ï¼šb main åœ¨ç¨‹åºå¼€å§‹è®¾ç½®æ–­ç‚¹ã€‚    |
| watch x == 3   | è®¾ç½®æ¡ä»¶æ–­ç‚¹ã€‚è¿™ä¸ªæ¯”VSçš„æ¡ä»¶æ–­ç‚¹æ›´æ–¹ä¾¿ï¼Œå› ä¸ºå®ƒä¸éœ€è¦è®¾ç½®åœ¨å“ªä¸€è¡Œï¼æ—¶åˆ»ç›‘æ§ï¼ |
| info break     | æŸ¥çœ‹å½“å‰å­˜åœ¨çš„æ‰€æœ‰æ–­ç‚¹ã€‚æ¯ä¸ªæ–­ç‚¹éƒ½æœ‰è‡ªå·±çš„ç¼–å·ã€‚             |
| delete N       | åˆ é™¤ç¼–å·ä¸ºNçš„é‚£ä¸ªæ–­ç‚¹ã€‚                                      |

### è°ƒè¯•è¿è¡Œ

| å‘½ä»¤ | æè¿°                                                         |
| ---- | ------------------------------------------------------------ |
| n    | â€œnextâ€ï¼Œè¿è¡Œä¸€è¡Œä»£ç ï¼Œ ç›¸å½“äºVSçš„step overã€‚                 |
| s    | â€œstepâ€ï¼Œè¿è¡Œä¸€ä¸ªæŒ‡ä»¤ï¼Œç›¸å½“äºVSçš„step inã€‚nå’Œséƒ½å¯ä»¥ä¸€æ¬¡è¿è¡Œå¤šè¡Œï¼Œæ¯”å¦‚n 5 |
| c    | â€œcontinueâ€ï¼Œç»§ç»­è¿è¡Œç›´åˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹ã€‚                         |
| f    | â€œfinishâ€ï¼Œè¿è¡Œå®Œå½“å‰ç¨‹åºï¼Œç›¸å½“äºVSçš„ step outã€‚              |

## vscode

é€šè¿‡é…ç½®`launch.json`å®ç°gdbè°ƒç”¨

```json
{
    // Use IntelliSense to learn about possible attributes.
    // Hover to view descriptions of existing attributes.
    // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387
    "version": "0.2.0",
    "configurations": [
        {
            "name": "(gdb) Launch",
            "type": "cppdbg",
            "request": "launch",
            "program": "${workspaceFolder}/build/bin/eigen_test",
            "args": [],
            "stopAtEntry": false,
            "cwd": "${workspaceFolder}",
            "environment": [],
            "externalConsole": false,
            "MIMode": "gdb",
            "miDebuggerPath": "/usr/bin/gdb",
            "setupCommands": [
                {
                    "description": "Enable pretty-printing for gdb",
                    "text": "-enable-pretty-printing",
                    "ignoreFailures": true
                }
            ]
        }
    ]
}
```

åŸºæœ¬å‚æ•°

- `program` è¦è°ƒè¯•çš„ç¨‹åºåï¼Œ`${workspaceFolder}`ä¸ºå½“å‰å·¥ä½œç›®å½•ï¼Œå³`.vscode`åŒçº§ç›®å½•
- `cwd` è°ƒè¯•ç¨‹åºçš„è·¯å¾„
- `miDebuggerPath` gdb çš„è·¯å¾„

é«˜çº§å‚æ•°

- `"preLaunchTask": "build"` ç”Ÿæˆå­ taskï¼Œå¯åœ¨é‡Œé¢ç¼–è¾‘ gcc å‘½ä»¤ç­‰ã€‚å…·ä½“å¯å‚è€ƒ [VSCode GDB è°ƒè¯•é…ç½®](https://blog.csdn.net/bingyu9875/article/details/94745028)
- `"miDebuggerServerAddress"` é…ç½®æœåŠ¡å™¨çš„åœ°å€å’Œç«¯å£

## ROS

### run

```bash
rosrun --prefix 'gdb -ex run --args' [package_name] [node_name] 
```

### launch

> éœ€å®‰è£…xterm

é€šè¿‡åœ¨launchä¸­è®¾ç½®`launch-prefix`å¯åŠ¨è°ƒè¯•ï¼Œå‚è€ƒ

- `launch-prefix="xterm -e gdb --args"` : run your node in a gdb in a separate xterm window, manually type `run` to start it 
- `launch-prefix="gdb -ex run --args"` : run your node in gdb in the same xterm as your launch without having to type `run` to start it 
- `launch-prefix="stterm -g 200x60 -e gdb -ex run --args"` : run your node in gdb in a new stterm window without having to type `run` to start it 
- `launch-prefix="valgrind"` : run your node in valgrind valgrindå·¥å…·å¯ä»¥ç”¨äºæ£€æµ‹å†…å­˜æ³„éœ²ï¼Œå¹¶æ‰§è¡Œæ€§èƒ½åˆ†æ 
- `launch-prefix="xterm -e"` : run your node in a separate xterm window 
- `launch-prefix="nice"` : nice your process to lower its CPU usage 
- `launch-prefix="screen -d -m gdb --args"` : useful if the node is being run on another machine; you can then ssh to that machine and do `screen -D -R` to see the gdb session 
- `launch-prefix="xterm -e python -m pdb"` : run your python node a separate xterm window in pdb for debugging; manually type `run` to start it 
- `launch-prefix="yappi -b -f pstat -o <filename>"`: run your rospy node in a multi-thread profiler such as `yappi`. 
- `launch-prefix="/path/to/run_tmux"`: run your node in a new tmux window; you'll need to create `/path/to/run_tmux` with the contents: 

C++ç¨‹åºå¯å¢åŠ `launch-prefix="xterm -e gdb -ex run --args "`

pythonç¨‹åºå¯å¢åŠ `launch-prefix="xterm -e python -m pdb "`

## å‚è€ƒ

[GDBè°ƒè¯•æŒ‡å—](https://blog.csdn.net/chen1415886044/article/details/105094688)

[GDBè°ƒè¯•æŒ‡å—]()

[rosé¡¹ç›®è°ƒè¯•:ROSé¡¹ç›®ä½¿ç”¨GDBè°ƒè¯•](https://blog.csdn.net/weixin_35695879/article/details/85254399)

# ä¿¡å·å¤„ç†

linuxä¸‹sigç±»å‹ï¼Œå¯ä»¥é€šè¿‡`kill -${sig_num} ${PID}`ç»™å¯¹åº”è¿›ç¨‹å‘é€ä¿¡å·ã€‚

```bash
 1) SIGHUP       2) SIGINT       3) SIGQUIT      4) SIGILL       5) SIGTRAP
 6) SIGABRT      7) SIGBUS       8) SIGFPE       9) SIGKILL     10) SIGUSR1
11) SIGSEGV     12) SIGUSR2     13) SIGPIPE     14) SIGALRM     15) SIGTERM # å‘é€ç»™ç¨‹åºçš„ç»ˆæ­¢è¯·æ±‚
16) SIGSTKFLT   17) SIGCHLD     18) SIGCONT     19) SIGSTOP     20) SIGTSTP
21) SIGTTIN     22) SIGTTOU     23) SIGURG      24) SIGXCPU     25) SIGXFSZ
26) SIGVTALRM   27) SIGPROF     28) SIGWINCH    29) SIGIO       30) SIGPWR
31) SIGSYS      34) SIGRTMIN    35) SIGRTMIN+1  36) SIGRTMIN+2  37) SIGRTMIN+3
38) SIGRTMIN+4  39) SIGRTMIN+5  40) SIGRTMIN+6  41) SIGRTMIN+7  42) SIGRTMIN+8
43) SIGRTMIN+9  44) SIGRTMIN+10 45) SIGRTMIN+11 46) SIGRTMIN+12 47) SIGRTMIN+13
48) SIGRTMIN+14 49) SIGRTMIN+15 50) SIGRTMAX-14 51) SIGRTMAX-13 52) SIGRTMAX-12
53) SIGRTMAX-11 54) SIGRTMAX-10 55) SIGRTMAX-9  56) SIGRTMAX-8  57) SIGRTMAX-7
58) SIGRTMAX-6  59) SIGRTMAX-5  60) SIGRTMAX-4  61) SIGRTMAX-3  62) SIGRTMAX-2
63) SIGRTMAX-1  64) SIGRTMAX
```

- SIGTERM å‘é€ç»™ç¨‹åºçš„ç»ˆæ­¢è¯·æ±‚
- SIGSEGV éæ³•å†…å­˜è®¿é—®ï¼ˆåˆ†æ®µé”™è¯¯ï¼‰
- SIGINT å¤–éƒ¨ä¸­æ–­ï¼Œé€šå¸¸ä¸ºç”¨æˆ·æ‰€èµ·å§‹
- SIGILL éæ³•ç¨‹åºæ˜ åƒï¼Œä¾‹å¦‚éæ³•æŒ‡ä»¤
- SIGABRT å¼‚å¸¸ç»ˆæ­¢æ¡ä»¶ï¼Œä¾‹å¦‚ä¸º [std::abort()](https://c-cpp.com/cpp/utility/program/abort.html) æ‰€èµ·å§‹
- SIGFPE é”™è¯¯ç®—æœ¯è¿ç®—ï¼Œä¾‹å¦‚é™¤ä»¥é›¶
- SIGPIPE PIPEç ´è£‚

åœ¨ä»£ç è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥è®¾ç½®å¯¹åº”çš„ä¿¡å·å¤„ç†å‡½æ•°ï¼Œè®°å½•ç¨‹åºå¼‚å¸¸æ—¶çš„å †æ ˆä¿¡æ¯ä»¥åˆ†æé—®é¢˜ã€‚

```cpp
#include <signal.h>

void sig_handler(int sig) {
    LOGE("signal: {}", sig);
    void *array[10];
    // è·å–å †æ ˆå†…å®¹ï¼ŒDebugæ¨¡å¼ä¸‹å¯ç”¨
    auto size = backtrace(array, 10);
    char **strings = backtrace_symbols(array, size);
    for (auto i = 0; i < size; i++) {
        LOGE("Backtrace: {}", strings[i]);  // å†™å †æ ˆæ—¥å¿—
    }
    free(strings);
    // é‡æ–°å‘å‡ºä¿¡å·ä»¥è§¦å‘é»˜è®¤å´©æºƒè¡Œä¸º
    signal(sig, SIG_DFL);
    raise(sig);
}

int main(int argc, char **argv){
    signal(SIGTERM, sig_handler);  // å‘é€ç»™ç¨‹åºçš„ç»ˆæ­¢è¯·æ±‚
    signal(SIGSEGV, sig_handler);  // éæ³•å†…å­˜è®¿é—®ï¼ˆåˆ†æ®µé”™è¯¯ï¼‰
    signal(SIGPIPE, sig_handler);  // PIPEç ´è£‚
    signal(SIGINT, sig_handler);   // å¤–éƒ¨ä¸­æ–­ï¼Œé€šå¸¸ä¸ºç”¨æˆ·æ‰€èµ·å§‹
    signal(SIGILL, sig_handler);   // éæ³•ç¨‹åºæ˜ åƒï¼Œä¾‹å¦‚éæ³•æŒ‡ä»¤
    signal(SIGABRT, sig_handler);  // å¼‚å¸¸ç»ˆæ­¢æ¡ä»¶ï¼Œä¾‹å¦‚ä¸º std::abort() æ‰€èµ·å§‹
    signal(SIGFPE, sig_handler);   // é”™è¯¯ç®—æœ¯è¿ç®—ï¼Œä¾‹å¦‚é™¤ä»¥é›¶
}
```

# ä»£ç æ£€æµ‹

- **é™æ€åˆ†æ**æ˜¯åœ¨ä»£ç ç¼–è¯‘å‰å‘ç°æ½œåœ¨é—®é¢˜ï¼Œè¦†ç›–æ‰€æœ‰ä»£ç è·¯å¾„ï¼ˆæ— è®ºæ˜¯å¦è¢«æ‰§è¡Œï¼‰ï¼Œä½†å¯èƒ½å­˜åœ¨è¯¯æŠ¥ï¼Œä¸”å¯¹å¤æ‚è¿è¡Œæ—¶é—®é¢˜ï¼ˆå¦‚åŠ¨æ€å†…å­˜ç®¡ç†å’Œå¹¶å‘ï¼‰çš„æ£€æµ‹èƒ½åŠ›æœ‰é™ã€‚

- **åŠ¨æ€åˆ†æ**ï¼ˆå°¤å…¶æ˜¯ASanå’ŒValgrindï¼‰æ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶å‘ç°å®é™…å‘ç”Ÿçš„é—®é¢˜ï¼Œå‡†ç¡®ç‡æé«˜ï¼Œå°¤å…¶æ“…é•¿æ£€æµ‹å†…å­˜é”™è¯¯å’Œå¹¶å‘é—®é¢˜ã€‚ä½†å®ƒä»¬éœ€è¦ç¨‹åºè¢«æ‰§è¡Œï¼Œä¸”ä¼šå¯¹æ€§èƒ½é€ æˆä¸€å®šå½±å“ã€‚

| ç‰¹æ€§                 | Cppcheck                                       | Clang Static Analyzer (scan-build/clang-tidy)                | AddressSanitizer (ASan)                                      | Valgrind (Memcheckç­‰)                               | Flawfinder                                 |
| -------------------- | ---------------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | --------------------------------------------------- | ------------------------------------------ |
| **åˆ†æç±»å‹**         | é™æ€åˆ†æ                                       | é™æ€åˆ†æ                                                     | åŠ¨æ€åˆ†æ (è¿è¡Œæ—¶æ’æ¡©)                                        | åŠ¨æ€åˆ†æ (è¿è¡Œæ—¶æ¨¡æ‹Ÿ)                               | é™æ€åˆ†æ                                   |
| **ä¸»è¦å…³æ³¨**         | ç¼–è¯‘å™¨ä¸æ£€æµ‹çš„ç¼ºé™·ï¼Œä½è¯¯æŠ¥ç‡ï¼Œå¯ç§»æ¤æ€§         | æ·±åº¦ç¼ºé™·ï¼ˆåŒ…æ‹¬å¤æ‚é€»è¾‘/å¹¶å‘ï¼‰ï¼Œä»£ç é£æ ¼ï¼Œæœ€ä½³å®è·µ            | è¿è¡Œæ—¶å†…å­˜é”™è¯¯ï¼ˆè¶Šç•Œã€UAFã€UARã€UASï¼‰ï¼Œå†…å­˜æ³„æ¼              | è¿è¡Œæ—¶å†…å­˜é”™è¯¯ï¼Œçº¿ç¨‹ç«äº‰ï¼Œæ€§èƒ½                      | æ½œåœ¨å®‰å…¨æ¼æ´ï¼ˆåŸºäºå·²çŸ¥å±é™©å‡½æ•°ï¼‰           |
| **åˆ†ææ·±åº¦**         | ä¸­ç­‰                                           | é«˜ï¼ˆåŸºäºASTå’Œæ•°æ®æµ/è·¯å¾„åˆ†æï¼‰                               | æé«˜ï¼ˆè¿è¡Œæ—¶ç²¾ç¡®æ£€æµ‹ï¼‰                                       | æé«˜ï¼ˆè¿è¡Œæ—¶è¡Œä¸ºï¼Œç²¾ç¡®åº¦é«˜ï¼‰                        | æµ…ï¼ˆåŸºäºæ¨¡å¼åŒ¹é…ï¼‰                         |
| **ä½¿ç”¨æ–¹å¼**         | ç‹¬ç«‹å·¥å…·ï¼Œç›´æ¥åˆ†ææºä»£ç                        | æ‹¦æˆªç¼–è¯‘å‘½ä»¤ (`scan-build`)ï¼Œæˆ–é›†æˆåˆ°æ„å»ºç³»ç»Ÿ (`clang-tidy`) | éœ€è¦ç”¨ç‰¹æ®Šç¼–è¯‘é€‰é¡¹ç¼–è¯‘ (`-fsanitize=address`)ï¼Œç„¶åè¿è¡Œç¨‹åº  | è¿è¡Œæ—¶å·¥å…·ï¼Œéœ€è¦ç¼–è¯‘å¹¶è¿è¡Œç¨‹åº                      | ç‹¬ç«‹å·¥å…·ï¼Œç›´æ¥åˆ†ææºä»£ç                    |
| **è¯¯æŠ¥ç‡**           | è¾ƒä½                                           | è¾ƒä½åˆ°ä¸­ç­‰ï¼ˆ`clang-tidy`è§„åˆ™å¤šå¯èƒ½æŠ¥å‘Šæ›´å¤šâ€œå»ºè®®â€ï¼‰           | æä½ï¼ˆå‡ ä¹æ— è¯¯æŠ¥ï¼‰                                           | æä½ï¼ˆè¿è¡Œæ—¶å‘ç°çš„é—®é¢˜é€šå¸¸æ˜¯çœŸå®å­˜åœ¨çš„ï¼‰            | ä¸­é«˜ï¼ˆåŸºäºæ¨¡å¼åŒ¹é…å¯èƒ½è¯¯æŠ¥ï¼‰               |
| **é›†æˆèƒ½åŠ›**         | æ˜“äºé›†æˆåˆ°CI/CDï¼ŒIDEæ’ä»¶å¯ç”¨                   | ä¸LLVM/Clangç”Ÿæ€ç³»ç»Ÿç´§å¯†é›†æˆï¼Œæ˜“äºé›†æˆåˆ°CI/CDï¼ŒIDEæ”¯æŒ       | ä¸Clang/GCCç¼–è¯‘å™¨ç´§å¯†é›†æˆï¼Œåœ¨CI/CDä¸­å¸¸ç”¨ä½œæµ‹è¯•ç¯èŠ‚           | éœ€è¦å•ç‹¬è¿è¡Œï¼Œç»“æœæŠ¥å‘Šé€šå¸¸ä¸ºæ–‡æœ¬æ ¼å¼ï¼Œå¯é›†æˆåˆ°CI/CD | æ˜“äºé›†æˆåˆ°CI/CDï¼Œç»“æœé€šå¸¸ä¸ºæ–‡æœ¬æ ¼å¼        |
| **æ€§èƒ½å¼€é”€**         | å¦ï¼ˆåˆ†ææ—¶é—´ï¼‰                                 | å¦ï¼ˆåˆ†ææ—¶é—´ï¼‰                                               | æ˜¯ï¼ˆè¿è¡Œæ—¶å¢åŠ CPUå’Œå†…å­˜å¼€é”€ï¼Œçº¦2xï¼‰                          | è¾ƒé«˜ï¼ˆè¿è¡Œæ—¶æ¨¡æ‹Ÿï¼Œçº¦5-20xæ€§èƒ½ä¸‹é™ï¼‰                 | å¦ï¼ˆåˆ†ææ—¶é—´ï¼‰                             |
| **å…¸å‹ç¼ºé™·**         | ç©ºæŒ‡é’ˆï¼Œå†…å­˜æ³„æ¼ï¼Œè¶Šç•Œï¼Œæœªåˆå§‹åŒ–å˜é‡ï¼Œèµ„æºæ³„æ¼ | æ›´å¤æ‚çš„å†…å­˜/èµ„æºç®¡ç†ï¼Œå¹¶å‘é—®é¢˜ï¼Œæœªå®šä¹‰è¡Œä¸ºï¼Œé£æ ¼é—®é¢˜        | å †/æ ˆ/å…¨å±€è¶Šç•Œï¼ŒUse-after-free/return/scopeï¼ŒDouble-freeï¼Œå†…å­˜æ³„æ¼ | ç²¾ç¡®çš„å†…å­˜æ³„æ¼ï¼Œå †æ ˆæº¢å‡ºï¼Œéæ³•è¯»å†™ï¼Œç«äº‰æ¡ä»¶        | ç¼“å†²åŒºæº¢å‡ºï¼Œæ ¼å¼å­—ç¬¦ä¸²æ¼æ´ï¼ŒTOCTOUç«äº‰æ¡ä»¶ |
| **å†…å­˜æ³„æ¼æ£€æµ‹èƒ½åŠ›** | æœ‰é™ï¼ˆä»…é™äºç®€å•æ¨¡å¼ï¼Œå¯èƒ½æ¼æŠ¥ï¼‰               | æœ‰é™ï¼ˆåŒCppcheckï¼Œæ›´å¤æ‚æ¨¡å¼ä»éš¾æ•æ‰ï¼‰                       | å¼ºï¼ˆé€šè¿‡LSanæ¨¡å—ï¼Œé«˜å‡†ç¡®ç‡æ£€æµ‹è¿è¡Œæ—¶æ³„æ¼ï¼‰                   | å¼ºï¼ˆé€šè¿‡Memcheckï¼Œé«˜å‡†ç¡®ç‡æ£€æµ‹è¿è¡Œæ—¶æ³„æ¼ï¼‰          | æ—                                          |

## é™æ€æ£€æµ‹

è¿™é‡Œä½¿ç”¨cppcheck

```bash
.
â”œâ”€â”€ build           # ç¼–è¯‘è¾“å‡ºï¼Œé™æ€æ£€æŸ¥æŠ¥å‘Šè¾“å‡º
â”œâ”€â”€ cmake           # å­˜æ”¾.cmakeæ–‡ä»¶
â”œâ”€â”€ CMakeLists.txt
â”œâ”€â”€ src             # ä»£ç 
â””â”€â”€ xslt            # å­˜æ”¾è½¬æ¢æ–‡ä»¶
```

å¯é€‰å‚æ•°

**1. æ£€æŸ¥èŒƒå›´å’Œç±»å‹æ§åˆ¶**

- `--enable=<id>`ï¼šå¯ç”¨é¢å¤–çš„æ£€æŸ¥ï¼Œä¸€èˆ¬ä½¿ç”¨allã€‚
- `--suppress=<spec>`ï¼šæŠ‘åˆ¶åŒ¹é… `<spec>` çš„è­¦å‘Š
- `--inline-suppr`ï¼šå…è®¸åœ¨ä»£ç ä¸­ä½¿ç”¨å†…è”æŠ‘åˆ¶ã€‚
- `--std=<id>`ï¼šè®¾ç½® C/C++ æ ‡å‡†ã€‚
- `--language=<language>`ï¼šå¼ºåˆ¶ Cppcheck å°†æ‰€æœ‰æ–‡ä»¶ä½œä¸ºç»™å®šè¯­è¨€æ£€æŸ¥ï¼Œæœ‰æ•ˆå€¼ä¸º `c` æˆ– `c++`ã€‚
- `--inconclusive`ï¼šå³ä½¿åˆ†æç»“æœä¸ç¡®å®šï¼Œä¹Ÿå…è®¸æŠ¥å‘Šç¼ºé™·ã€‚

**2. é¢„å¤„ç†å™¨å’ŒåŒ…å«è·¯å¾„**

- `-I <dir>`ï¼šæŒ‡å®šåŒ…å«æ–‡ä»¶çš„æœç´¢è·¯å¾„ã€‚å¯ä»¥æä¾›å¤šä¸ª `-I` å‚æ•°æ¥æŒ‡å®šå¤šä¸ªè·¯å¾„ã€‚

**3. æŠ¥å‘Šå’Œè¾“å‡º**

- `-j <jobs>`ï¼šå¯åŠ¨ `<jobs>` ä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œæ£€æŸ¥ã€‚
- `-q, --quiet`ï¼šåªåœ¨æœ‰é”™è¯¯æ—¶æ‰“å°ä¿¡æ¯ã€‚
- `-rp, --relative-paths=<paths>`ï¼šåœ¨è¾“å‡ºä¸­ä½¿ç”¨ç›¸å¯¹è·¯å¾„ã€‚å½“ç»™å®š `<paths>` æ—¶ï¼Œä¼šå°†å…¶ç”¨ä½œåŸºå‡†è·¯å¾„ã€‚å¤šä¸ªè·¯å¾„å¯ä»¥ç”¨ `;` åˆ†éš”ã€‚
- `--xml`ï¼šä»¥ XML æ ¼å¼è¾“å‡ºç»“æœã€‚å¸¸ç”¨äºä¸å…¶ä»–å·¥å…·é›†æˆã€‚
- `--xml-version=<version>`ï¼šæŒ‡å®š XML è¾“å‡ºçš„ç‰ˆæœ¬ã€‚
- `--template=<format>`ï¼šè‡ªå®šä¹‰æŠ¥å‘Šçš„è¾“å‡ºæ ¼å¼ã€‚

**4. é…ç½®å’Œé«˜çº§é€‰é¡¹**

- `--check-config`ï¼šæ£€æŸ¥ Cppcheck é…ç½®ï¼Œä½¿ç”¨æ­¤æ ‡å¿—æ—¶ï¼Œä¼šç¦ç”¨æ­£å¸¸çš„ä»£ç åˆ†æã€‚
- `--check-library`ï¼šå½“åº“æ–‡ä»¶ä¿¡æ¯ä¸å®Œæ•´æ—¶æ˜¾ç¤ºä¿¡æ¯æ€§æ¶ˆæ¯ã€‚
- `-f, --force`ï¼šå¼ºåˆ¶æ£€æŸ¥åŒ…å«å¤§é‡é…ç½®çš„æ–‡ä»¶ã€‚å¦‚æœæ‰¾åˆ°æ­¤ç±»æ–‡ä»¶ï¼Œä¼šæ‰“å°é”™è¯¯ï¼Œå¦‚æœä¸ `--max-configs=` ä¸€èµ·ä½¿ç”¨ï¼Œåˆ™æœ€åä¸€ä¸ªé€‰é¡¹æœ‰æ•ˆã€‚
- `--max-configs=<num>`ï¼šé™åˆ¶æ¯ä¸ªç¬¦å·çš„æœ€å¤§é…ç½®æ•°ã€‚
- `--addon=<addon>`ï¼šæ‰§è¡Œ Cppcheck æ’ä»¶ï¼ˆAddonï¼‰ã€‚

### æ„å»ºCMAKE

`filter_compile_commands.py`

```python
#!/usr/bin/env python3
"""
è¿‡æ»¤compile_commands.jsonï¼Œåªä¿ç•™é¡¹ç›®æºä»£ç çš„ç¼–è¯‘å•å…ƒï¼Œæ’é™¤ç¬¬ä¸‰æ–¹åº“
"""
import json
import sys
import os


def filter_compile_commands(input_file, output_file, source_dir):
    """Filter compile_commands.json to only include project source files"""
    with open(input_file, 'r', encoding='utf-8') as f:
        commands = json.load(f)
    
    # åªä¿ç•™srcç›®å½•å’Œappç›®å½•ä¸‹çš„æ–‡ä»¶
    # æ’é™¤thirdpartyã€build/_depsç­‰ç¬¬ä¸‰æ–¹åº“ç›®å½•
    filtered = []
    src_dir = os.path.join(source_dir, 'src')
    app_dir = os.path.join(source_dir, 'app')
    exclude_patterns = ['thirdparty', '_deps', 'external', 'third_party', 'build']
    
    for cmd in commands:
        file_path = cmd.get('file', '')
        # è§„èŒƒåŒ–è·¯å¾„ä»¥è¿›è¡Œæ¯”è¾ƒ
        file_path_normalized = os.path.normpath(file_path)
        
        # æ£€æŸ¥æ˜¯å¦åœ¨srcæˆ–appç›®å½•ä¸­
        in_src = file_path_normalized.startswith(os.path.normpath(src_dir))
        in_app = file_path_normalized.startswith(os.path.normpath(app_dir))
        
        # æ£€æŸ¥æ˜¯å¦åŒ…å«æ’é™¤çš„æ¨¡å¼
        exclude = any(pattern in file_path_normalized for pattern in exclude_patterns)
        
        if (in_src or in_app) and not exclude:
            filtered.append(cmd)
    
    with open(output_file, 'w', encoding='utf-8') as f:
        json.dump(filtered, f, indent=2)
    
    print(f'Filtered {len(commands)} -> {len(filtered)} compilation units')
    return len(filtered)


if __name__ == '__main__':
    if len(sys.argv) != 4:
        print('Usage: filter_compile_commands.py <input> <output> <source_dir>')
        sys.exit(1)
    
    count = filter_compile_commands(sys.argv[1], sys.argv[2], sys.argv[3])
    sys.exit(0 if count > 0 else 1)
```

`static_check.cmake`

```cmake
# ================================
# C++ é™æ€æ£€æŸ¥é…ç½®
# ================================
# åŠŸèƒ½ï¼šå¯¹é¡¹ç›®æºä»£ç è¿›è¡Œé™æ€åˆ†æï¼Œæ’é™¤ç¬¬ä¸‰æ–¹åº“
# ä½¿ç”¨ï¼šmake run_cppcheck æˆ– make all_cppcheck_reports
# ================================

# ç”Ÿæˆç¼–è¯‘æ•°æ®åº“
set(CMAKE_EXPORT_COMPILE_COMMANDS ON)

# ============ æŸ¥æ‰¾å·¥å…· ============
find_program(CPPCHECK_EXECUTABLE cppcheck)
if(NOT CPPCHECK_EXECUTABLE)
    message(FATAL_ERROR "Cppcheck executable not found. Please install Cppcheck or set its path.")
endif()

find_package(Python3 COMPONENTS Interpreter)
if(NOT Python3_FOUND)
    message(WARNING "Python3 not found. Will use unfiltered compile_commands.json")
endif()

find_program(XSLTPROC_EXECUTABLE xsltproc)
if(NOT XSLTPROC_EXECUTABLE)
    message(FATAL_ERROR "xsltproc executable not found. Please install xsltproc.")
endif()

# ============ æ–‡ä»¶è·¯å¾„é…ç½® ============
set(FILTER_SCRIPT ${CMAKE_SOURCE_DIR}/cmake/modules/filter_compile_commands.py)
set(FILTERED_COMPILE_COMMANDS ${CMAKE_BINARY_DIR}/compile_commands_filtered.json)
set(CPPCHECK_SUPPRESSIONS ${CMAKE_BINARY_DIR}/cppcheck_suppressions.txt)
set(CPPCHECK_XML_REPORT ${CMAKE_BINARY_DIR}/cppcheck_report.xml)
set(CPPCHECK_HTML_REPORT ${CMAKE_BINARY_DIR}/cppcheck_report.html)
set(CPPCHECK_XSLT_STYLESHEET ${CMAKE_SOURCE_DIR}/xslt/cppcheck_report.xslt)

# ç¡®ä¿ XSLT æ ·å¼è¡¨å­˜åœ¨
if(NOT EXISTS ${CPPCHECK_XSLT_STYLESHEET})
    message(FATAL_ERROR "Cppcheck XSLT stylesheet not found: ${CPPCHECK_XSLT_STYLESHEET}")
endif()

# ============ ç”ŸæˆæŠ‘åˆ¶è§„åˆ™æ–‡ä»¶ ============
# æ’é™¤å¸¸è§ç¬¬ä¸‰æ–¹åº“çš„å¤´æ–‡ä»¶æ£€æŸ¥ï¼ˆROSã€Eigen3ã€PCLã€Boostç­‰ï¼‰
file(WRITE ${CPPCHECK_SUPPRESSIONS} "# Suppress all checks in third-party libraries
# ROS libraries
*:/opt/ros/*
*:*/ros/*
*:*/catkin/*
*:*/roscpp/*
*:*/rosbag/*
*:*/std_msgs/*
*:*/sensor_msgs/*
*:*/geometry_msgs/*
*:*/nav_msgs/*
*:*/tf/*
*:*/tf2/*

# Eigen library
*:*/eigen3/*
*:*/Eigen/*

# PCL library
*:*/pcl/*
*:*/pcl-*/include/*

# TBB library
*:*/tbb/*
*:*/oneapi/*

# Boost library
*:*/boost/*

# OpenCV library
*:*/opencv/*
*:*/opencv2/*
*:*/opencv4/*

# System libraries
*:/usr/include/*
*:/usr/local/include/*

# Project third-party directories
*:*/thirdparty/*
*:*/_deps/*
*:*/external/*
*:*/third_party/*
*:*/vendor/*
")

# ============ è¿‡æ»¤ç¼–è¯‘æ•°æ®åº“ ============
if(Python3_FOUND)
    add_custom_target(filter_compile_commands
        COMMAND ${Python3_EXECUTABLE} ${FILTER_SCRIPT} 
                ${CMAKE_BINARY_DIR}/compile_commands.json
                ${FILTERED_COMPILE_COMMANDS}
                ${CMAKE_SOURCE_DIR}
        WORKING_DIRECTORY ${CMAKE_BINARY_DIR}
        COMMENT "Filtering compile_commands.json to exclude third-party libraries..."
        VERBATIM
    )
    set(CPPCHECK_COMPILE_DB ${FILTERED_COMPILE_COMMANDS})
else()
    set(CPPCHECK_COMPILE_DB ${CMAKE_BINARY_DIR}/compile_commands.json)
endif()

# ============ è¿è¡Œ Cppcheck ============
add_custom_target(run_cppcheck
    COMMAND ${CPPCHECK_EXECUTABLE}
            --inline-suppr
            --std=c++17
            --enable=all
            --quiet
            --force
            --inconclusive
            --language=c++
            --project=${CPPCHECK_COMPILE_DB}
            --suppressions-list=${CPPCHECK_SUPPRESSIONS}
            --suppress=noValidConfiguration
            --suppress=missingIncludeSystem
            --max-configs=1
            -i${CMAKE_SOURCE_DIR}/thirdparty
            -i${CMAKE_BINARY_DIR}/_deps
            --xml
            --xml-version=2
            --output-file=${CPPCHECK_XML_REPORT}
    WORKING_DIRECTORY ${CMAKE_BINARY_DIR}
    COMMENT "Running Cppcheck static analysis..."
    VERBATIM
)

if(Python3_FOUND)
    add_dependencies(run_cppcheck filter_compile_commands)
endif()

# ============ ç”Ÿæˆ HTML æŠ¥å‘Š ============
add_custom_target(generate_cppcheck_html
    COMMAND ${XSLTPROC_EXECUTABLE} ${CPPCHECK_XSLT_STYLESHEET} ${CPPCHECK_XML_REPORT} > ${CPPCHECK_HTML_REPORT}
    WORKING_DIRECTORY ${CMAKE_BINARY_DIR}
    COMMENT "Generating HTML report from Cppcheck XML..."
    VERBATIM
)

add_dependencies(generate_cppcheck_html run_cppcheck)

# ============ ç»„åˆç›®æ ‡ ============
add_custom_target(all_cppcheck_reports)
add_dependencies(all_cppcheck_reports generate_cppcheck_html)

```

`cppcheck_report.xslt`

```xml
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:output method="html" indent="yes" encoding="UTF-8" omit-xml-declaration="yes"/>

<xsl:template match="/">
<html>
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cppcheck æŠ¥å‘Š</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 20px;
      color: #333;
      background-color: #f8f9fa;
    }
    .header {
      background: linear-gradient(135deg, #1a237e, #0d47a1); /* åŠ æ·±è“è‰²æ¢¯åº¦ */
      color: white;
      text-align: center;
      padding: 25px 30px;
      border-radius: 8px;
      margin-bottom: 25px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); /* åŠ æ·±é˜´å½± */
    }
    .header h1 {
      font-weight: 700; /* åŠ ç²—å­—ä½“ */
      margin-bottom: 8px;
      font-size: 2.4rem; /* å¢å¤§å­—å· */
      text-shadow: 0 2px 4px rgba(0,0,0,0.3); /* æ·»åŠ æ–‡å­—é˜´å½± */
      letter-spacing: 0.5px; /* å¢åŠ å­—é—´è· */
    }
    .header p {
      opacity: 0.9;
      font-size: 1.1rem;
      text-shadow: 0 1px 2px rgba(0,0,0,0.2); /* å‰¯æ ‡é¢˜ä¹Ÿæ·»åŠ é˜´å½± */
    }
    @media (max-width: 768px) {
      .header h1 {
        font-size: 1.8rem;
      }
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 15px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      background-color: white;
      border-radius: 8px;
      overflow: hidden;
    }
    th, td {
      border: 1px solid #f0f0f0;
      padding: 14px 20px;
      text-align: left;
      vertical-align: top;
    }
    th {
      background-color: #f5f7ff;
      color: #1a237e;
      font-weight: 600;
      border-bottom: 2px solid #e0e0e0;
    }
    tr:hover {
      background-color: #f8fbff;
    }
    .severity-tag {
      display: inline-block;
      padding: 5px 12px;
      border-radius: 14px;
      font-size: 0.85rem;
      font-weight: 600;
      text-align: center;
      min-width: 80px;
    }
    .error .severity-tag { 
      background-color: #ffcdd2; 
      color: #d32f2f; 
    }
    .warning .severity-tag { 
      background-color: #ffe0b2; 
      color: #f57c00; 
    }
    .style .severity-tag { 
      background-color: #bbdefb; 
      color: #1976d2; 
    }
    .information .severity-tag { 
      background-color: #e1bee7; 
      color: #7b1fa2; 
    }
    .location {
      font-family: monospace;
      font-size: 0.9em;
      color: #555;
    }
    .summary {
      background-color: white;
      padding: 25px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      margin: 20px 0;
    }
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 18px;
      margin-top: 10px;
    }
    .summary-item {
      background: white;
      padding: 20px 15px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.07);
      text-align: center;
      border: 1px solid #e0e0e0;
      transition: all 0.3s ease;
    }
    .summary-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    .stats-label {
      font-size: 0.95rem;
      color: #616161;
      margin-bottom: 8px;
      font-weight: 500;
    }
    .stats-value {
      font-weight: 700;
      font-size: 2.2rem;
    }
    .error-count { color: #d32f2f; }
    .warning-count { color: #f57c00; }
    .style-count { color: #1976d2; }
    .information-count { color: #7b1fa2; }
    .footer {
      text-align: center;
      margin-top: 30px;
      color: #757575;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>Cppcheck é™æ€åˆ†ææŠ¥å‘Š</h1>
    <p>ç‰ˆæœ¬ <xsl:value-of select="results/cppcheck/@version"/> | æŠ¥å‘Šæ ¼å¼ç‰ˆæœ¬ <xsl:value-of select="results/@version"/></p>
  </div>
  
  <!-- æ±‡æ€»ç»Ÿè®¡ -->
  <div class="summary">
    <h2>ğŸ“Š é—®é¢˜æ¦‚è§ˆ</h2>
    <div class="summary-grid">
      <xsl:variable name="errors" select="count(results/errors/error[@severity='error'])"/>
      <xsl:variable name="warnings" select="count(results/errors/error[@severity='warning'])"/>
      <xsl:variable name="styles" select="count(results/errors/error[@severity='style'])"/>
      <xsl:variable name="infos" select="count(results/errors/error[@severity='information'])"/>
      <xsl:variable name="total" select="count(results/errors/error)"/>
      
      <div class="summary-item">
        <div class="stats-label">é—®é¢˜æ€»æ•°</div>
        <div class="stats-value"><xsl:value-of select="$total"/></div>
      </div>
      
      <div class="summary-item">
        <div class="stats-label">é”™è¯¯</div>
        <div class="stats-value error-count"><xsl:value-of select="$errors"/></div>
      </div>
      
      <div class="summary-item">
        <div class="stats-label">è­¦å‘Š</div>
        <div class="stats-value warning-count"><xsl:value-of select="$warnings"/></div>
      </div>
      
      <div class="summary-item">
        <div class="stats-label">ä»£ç é£æ ¼</div>
        <div class="stats-value style-count"><xsl:value-of select="$styles"/></div>
      </div>
      
      <div class="summary-item">
        <div class="stats-label">ä¿¡æ¯</div>
        <div class="stats-value information-count"><xsl:value-of select="$infos"/></div>
      </div>
    </div>
  </div>
  
  <!-- é—®é¢˜è¯¦æƒ…è¡¨æ ¼ -->
  <h2>ğŸ” è¯¦ç»†é—®é¢˜åˆ—è¡¨</h2>
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>ä¸¥é‡ç¨‹åº¦</th>
        <th>æ¶ˆæ¯</th>
        <th>ä½ç½®</th>
        <th>CWE</th>
      </tr>
    </thead>
    <tbody>
      <xsl:choose>
        <xsl:when test="count(results/errors/error) = 0">
          <tr>
            <td colspan="5" style="text-align:center; padding:30px; background-color:#f9f9f9;">
              ğŸ‰ æ­å–œï¼æœªå‘ç°ä»»ä½•é™æ€åˆ†æé—®é¢˜
            </td>
          </tr>
        </xsl:when>
        <xsl:otherwise>
          <xsl:apply-templates select="results/errors/error"/>
        </xsl:otherwise>
      </xsl:choose>
    </tbody>
  </table>
  
  <div class="footer">
    <p>æŠ¥å‘Šç”Ÿæˆæ—¶é—´: <script>document.write(new Date().toLocaleString());</script></p>
    <p>é—®é¢˜åé¦ˆ: jassimxiong@gmail.com</p>
  </div>
</body>
</html>
</xsl:template>

<xsl:template match="error">
  <tr class="{@severity}">
    <td><xsl:value-of select="@id"/></td>
    <td>
      <span class="severity-tag"><xsl:value-of select="@severity"/></span>
    </td>
    <td>
      <strong><xsl:value-of select="@msg"/></strong>
      <div style="margin-top:5px; font-size:0.9em; color:#666;">
        <xsl:value-of select="@verbose"/>
      </div>
    </td>
    <td class="location">
      <xsl:choose>
        <xsl:when test="location">
          <div><strong>æ–‡ä»¶:</strong> <xsl:value-of select="location/@file"/></div>
          <div><strong>è¡Œ:</strong> <xsl:value-of select="location/@line"/></div>
          <xsl:if test="location/@column">
            <div><strong>åˆ—:</strong> <xsl:value-of select="location/@column"/></div>
          </xsl:if>
          <xsl:if test="location/symbol">
            <div><strong>ç¬¦å·:</strong> <xsl:value-of select="location/symbol"/></div>
          </xsl:if>
        </xsl:when>
        <xsl:otherwise>å…¨å±€é—®é¢˜</xsl:otherwise>
      </xsl:choose>
    </td>
    <td>
      <xsl:choose>
        <xsl:when test="@cwe">
          <a href="https://cwe.mitre.org/data/definitions/{@cwe}.html" target="_blank" style="color:#1a237e; text-decoration:none;">
            CWE-<xsl:value-of select="@cwe"/>
          </a>
        </xsl:when>
        <xsl:otherwise>-</xsl:otherwise>
      </xsl:choose>
    </td>
  </tr>
</xsl:template>

</xsl:stylesheet>
```

### ä½¿ç”¨

ä½¿ç”¨ [Cppcheck](https://cppcheck.sourceforge.io/) å¯¹é¡¹ç›®C++ä»£ç è¿›è¡Œé™æ€åˆ†æï¼Œè‡ªåŠ¨æ’é™¤ç¬¬ä¸‰æ–¹åº“ï¼ˆROSã€Eigen3ã€PCLã€Boostç­‰ï¼‰çš„æ£€æŸ¥ã€‚

- ä¾èµ–

  ```bash
  sudo apt install cppcheck xsltproc python3
  ```

- ä½¿ç”¨

  ```bash
  cd build
  cmake ..
  
  # æ–¹å¼1ï¼šç”Ÿæˆå®Œæ•´æŠ¥å‘Šï¼ˆæ¨èï¼‰
  make all_cppcheck_reports
  
  # æ–¹å¼2ï¼šåªè¿è¡Œé™æ€æ£€æŸ¥
  make run_cppcheck
  
  # æ–¹å¼3ï¼šåªç”ŸæˆHTMLæŠ¥å‘Šï¼ˆéœ€å…ˆè¿è¡Œcppcheckï¼‰
  make generate_cppcheck_html
  
  # æˆ–è€…
  cmake --build . --target run_cppcheck --parallel           # è¿›è¡Œé™æ€æ£€æŸ¥
  cmake --build . --target all_cppcheck_reports --parallel   # è¿›è¡Œé™æ€æ£€æŸ¥å¹¶ç”ŸæˆhtmlæŠ¥å‘Š
  ```

- æŸ¥çœ‹ç»“æœ

  - **XMLæŠ¥å‘Š**ï¼š`build/cppcheck_report.xml`

  - **HTMLæŠ¥å‘Š**ï¼š`build/cppcheck_report.html` ï¼ˆæ¨èï¼Œå¯åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼‰

  - **è¿‡æ»¤åçš„ç¼–è¯‘æ•°æ®åº“**ï¼š`build/compile_commands_filtered.json`


- é…ç½®è¯´æ˜

  é™æ€æ£€æŸ¥é…ç½®ä½äº `cmake/static_check.cmake`ï¼Œå·²é…ç½®ä¸ºï¼š

  - âœ… åªæ£€æŸ¥ `src/` å’Œ `app/` ç›®å½•ä¸‹çš„é¡¹ç›®ä»£ç 

  - âœ… æ’é™¤æ‰€æœ‰ç¬¬ä¸‰æ–¹åº“ï¼ˆROSã€Eigen3ã€PCLã€TBBã€Boostã€OpenCVç­‰ï¼‰

  - âœ… æŠ‘åˆ¶é…ç½®ç›¸å…³çš„ä¿¡æ¯çº§åˆ«è­¦å‘Šï¼ˆnoValidConfigurationã€missingIncludeSystemï¼‰

  - âœ… ä½¿ç”¨C++17æ ‡å‡†è¿›è¡Œæ£€æŸ¥


â€‹	å¦‚éœ€ä¿®æ”¹æ£€æŸ¥èŒƒå›´æˆ–è§„åˆ™ï¼Œç¼–è¾‘ `cmake/static_check.cmake` å’Œ `cmake/filter_compile_commands.py`ã€‚

## åŠ¨æ€æ£€æµ‹

[Sanitizer](https://github.com/google/sanitizers/wiki/)æ˜¯ç”±Googleå‘èµ·çš„å¼€æºå·¥å…·é›†ï¼Œç”¨äºæ£€æµ‹å†…å­˜æ³„éœ²ç­‰é—®é¢˜ã€‚

- **AddressSanitizer**ï¼Œæ£€æµ‹å†…å­˜è®¿é—®é—®é¢˜
- **MemorySanitizer**ï¼Œæ£€æµ‹æœªåˆå§‹åŒ–å†…å­˜é—®é¢˜
- **ThreadSanitizer**ï¼Œæ£€æµ‹çº¿ç¨‹ç«æ€å’Œæ­»é”é—®é¢˜
- **LeakSanitizer**ï¼Œæ£€æµ‹å†…å­˜æ³„éœ²é—®é¢˜

å‚è€ƒ[sanitizers-cmake](https://github.com/arsenm/sanitizers-cmake)å®ç°è°ƒç”¨

```cmake
cmake_minimum_required(VERSION 2.8 FATAL_ERROR)

project(ioctree_demo)

add_compile_options(-std=c++14 )
set(CMAKE_CXX_FLAGS "-std=c++14 -pthread")  # æ³¨æ„ä¸èƒ½å¼€å¯ä»£ç ä¼˜åŒ–ï¼Œå¦åˆ™éƒ¨åˆ†å†…å­˜æ³„æ¼ä¼šè¢«ä¼˜åŒ–
add_definitions(-w)
find_package(PCL 1.8 REQUIRED)

set(CMAKE_MODULE_PATH "${CMAKE_SOURCE_DIR}/sanitizers-cmake/cmake" ${CMAKE_MODULE_PATH})
find_package(Sanitizers REQUIRED)

include_directories(
    ${PCL_INCLUDE_DIRS}
    ikd-Tree
    octree2
)

add_executable(time_compare examples/time_compare.cpp ikd-Tree/ikd_Tree.cpp)
target_link_libraries(time_compare ${PCL_LIBRARIES})
add_sanitizers(time_compare)
```

ç¼–è¯‘æ—¶åŠ å…¥ç¼–è¯‘é€‰é¡¹å¯ç”¨åŠŸèƒ½ï¼Œ`SANITIZE_ADDRESS`, `SANITIZE_MEMORY`, `SANITIZE_THREAD` or `SANITIZE_UNDEFINED`

```bash
cmake .. -DSANITIZE_ADDRESS=On
```

### AddressSanitizer

### é—®é¢˜è®°å½•

æŠ¥é”™æ‰¾ä¸åˆ°`libasan.so.5`åº“ï¼Œè®¾ç½®`-static-libasan`ï¼Œé“¾æ¥é™æ€åº“ã€‚

https://blog.csdn.net/register_k/article/details/120319834



## å‚è€ƒ

[å¼€å‘è°ƒè¯•åˆ©å™¨ | å†…å­˜æ£€æµ‹å·¥å…·Sanitizer](https://zhuanlan.zhihu.com/p/691182407)

[ã€NO.114ã€‘C++å†…å­˜ç®¡ç†åŠå†…å­˜é—®é¢˜çš„åˆ†æ](https://github.com/0voice/cpp_backend_awsome_blog/blob/main/%E3%80%90NO.114%E3%80%91C%2B%2B%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E5%8F%8A%E5%86%85%E5%AD%98%E9%97%AE%E9%A2%98%E7%9A%84%E5%88%86%E6%9E%90.md)

# èµ„æºåˆ†æ

pidstatæ˜¯sysstatå·¥å…·çš„ä¸€ä¸ªå‘½ä»¤ï¼Œç”¨äºç›‘æ§å…¨éƒ¨æˆ–æŒ‡å®šè¿›ç¨‹çš„cpuã€å†…å­˜ã€çº¿ç¨‹ã€è®¾å¤‡IOç­‰ç³»ç»Ÿèµ„æºçš„å ç”¨æƒ…å†µã€‚

```bash
pidstat [ é€‰é¡¹ ] [ <æ—¶é—´é—´éš”> ] [ <æ¬¡æ•°> ]
```

å¸¸ç”¨çš„å‚æ•°ï¼š

- -uï¼šé»˜è®¤çš„å‚æ•°ï¼Œæ˜¾ç¤ºå„ä¸ªè¿›ç¨‹çš„cpuä½¿ç”¨ç»Ÿè®¡
- -rï¼šæ˜¾ç¤ºå„ä¸ªè¿›ç¨‹çš„å†…å­˜ä½¿ç”¨ç»Ÿè®¡
- -dï¼šæ˜¾ç¤ºå„ä¸ªè¿›ç¨‹çš„IOä½¿ç”¨æƒ…å†µ
- -pï¼šæŒ‡å®šè¿›ç¨‹å·
- -wï¼šæ˜¾ç¤ºæ¯ä¸ªè¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æƒ…å†µ
- -tï¼šæ˜¾ç¤ºé€‰æ‹©ä»»åŠ¡çš„çº¿ç¨‹çš„ç»Ÿè®¡ä¿¡æ¯å¤–çš„é¢å¤–ä¿¡æ¯
- -T { TASK | CHILD | ALL }
  è¿™ä¸ªé€‰é¡¹æŒ‡å®šäº†pidstatç›‘æ§çš„ã€‚TASKè¡¨ç¤ºæŠ¥å‘Šç‹¬ç«‹çš„taskï¼ŒCHILDå…³é”®å­—è¡¨ç¤ºæŠ¥å‘Šè¿›ç¨‹ä¸‹æ‰€æœ‰çº¿ç¨‹ç»Ÿè®¡ä¿¡æ¯ã€‚ALLè¡¨ç¤ºæŠ¥å‘Šç‹¬ç«‹çš„taskå’Œtaskä¸‹é¢çš„æ‰€æœ‰çº¿ç¨‹ã€‚
  æ³¨æ„ï¼štaskå’Œå­çº¿ç¨‹çš„å…¨å±€çš„ç»Ÿè®¡ä¿¡æ¯å’Œpidstaté€‰é¡¹æ— å…³ã€‚è¿™äº›ç»Ÿè®¡ä¿¡æ¯ä¸ä¼šå¯¹åº”åˆ°å½“å‰çš„ç»Ÿè®¡é—´éš”ï¼Œè¿™äº›ç»Ÿè®¡ä¿¡æ¯åªæœ‰åœ¨å­çº¿ç¨‹killæˆ–è€…å®Œæˆçš„æ—¶å€™æ‰ä¼šè¢«æ”¶é›†ã€‚
- -Vï¼šç‰ˆæœ¬å·
- -hï¼šåœ¨ä¸€è¡Œä¸Šæ˜¾ç¤ºäº†æ‰€æœ‰æ´»åŠ¨ï¼Œè¿™æ ·å…¶ä»–ç¨‹åºå¯ä»¥å®¹æ˜“è§£æã€‚
- -Iï¼šåœ¨SMPç¯å¢ƒï¼Œè¡¨ç¤ºä»»åŠ¡çš„CPUä½¿ç”¨ç‡/å†…æ ¸æ•°é‡
- -lï¼šæ˜¾ç¤ºå‘½ä»¤åå’Œæ‰€æœ‰å‚æ•°

ä¾‹å­æŒ‰2sé¢‘ç‡ç›‘å¬è¿›ç¨‹çš„CPUå’Œå†…å­˜å ç”¨ï¼Œå¹¶å†™å…¥åˆ°æ—¥å¿—é‡Œ

```bash
pidstat -u -r -p 15249 2 > run_mapping.log
```

ä½¿ç”¨pythonè§£ææ—¥å¿—å¹¶è¾“å‡ºåˆ†æ

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
PIDSTAT Log Analysis Tool
Features:
1. Read pidstat log file with CPU and memory usage data
2. Calculate average and maximum resource usage statistics
3. Generate statistical report
4. Plot CPU and memory usage vs time charts with English labels

Usage:
python pidstat_analyzer.py <log_file_path>

Example:
python pidstat_analyzer.py pidstat.log

Output files:
- resource_report.txt: Resource usage statistics report
- cpu_usage.png: CPU usage chart
- memory_usage.png: Memory usage chart
"""

import re
import pandas as pd
import matplotlib.pyplot as plt
import numpy as np
from datetime import datetime, timedelta
import matplotlib.dates as mdates
import sys
import os
import matplotlib

# Configure matplotlib for better English text rendering
matplotlib.use('Agg')  # Use non-interactive backend
plt.rcParams['font.family'] = 'sans-serif'
plt.rcParams['font.sans-serif'] = ['Arial', 'DejaVu Sans', 'Liberation Sans', 'sans-serif']
plt.rcParams['axes.unicode_minus'] = False  # Fix negative sign display

def parse_pidstat_log(file_path):
    """
    Parse pidstat log file to extract CPU and memory data
    
    Args:
        file_path (str): Path to the log file
        
    Returns:
        tuple: (cpu_data_list, mem_data_list)
            cpu_data_list: List of CPU data dictionaries
            mem_data_list: List of memory data dictionaries
    """
    try:
        with open(file_path, 'r', encoding='utf-8') as f:
            lines = f.readlines()
    except FileNotFoundError:
        print(f"Error: File '{file_path}' not found")
        sys.exit(1)
    except Exception as e:
        print(f"Error: Failed to read file - {e}")
        sys.exit(1)
    
    cpu_data = []
    mem_data = []
    current_section = None
    header_pattern = re.compile(r'\s*UID\s+PID\s+')
    
    for line_num, line in enumerate(lines, 1):
        line = line.strip()
        if not line:
            continue
        
        # Skip system info line
        if line.startswith('Linux'):
            continue
        
        # Detect CPU data header
        if re.search(r'%usr\s+%system\s+%guest\s+%wait\s+%CPU\s+CPU\s+Command', line):
            current_section = 'cpu'
            continue
        
        # Detect memory data header
        if re.search(r'minflt/s\s+majflt/s\s+VSZ\s+RSS\s+%MEM\s+Command', line):
            current_section = 'mem'
            continue
        
        # Skip header lines that contain "UID PID"
        if header_pattern.match(line):
            continue
        
        # Parse time - handle both Chinese and numeric formats
        time_match = re.match(r'(\d+)[æ—¶:](\d+)[åˆ†:](\d+)ç§’?', line)
        if not time_match:
            continue
        
        hour, minute, second = map(int, time_match.groups())
        time_str = f"{hour:02d}:{minute:02d}:{second:02d}"
        
        # Extract data part after time
        time_prefix = f"{hour}æ—¶{minute}åˆ†{second}ç§’"
        if time_prefix in line:
            data_part = line[len(time_prefix):].strip()
        else:
            # Try alternative time format
            time_prefix_alt = f"{hour:02d}:{minute:02d}:{second:02d}"
            if time_prefix_alt in line:
                data_part = line[len(time_prefix_alt):].strip()
            else:
                data_part = line[time_match.end():].strip()
        
        if not data_part:
            continue
        
        # Split data by whitespace, but handle command name properly
        parts = re.split(r'\s+', data_part)
        
        try:
            if current_section == 'cpu':
                # Expected format: UID PID %usr %system %guest %wait %CPU CPU Command
                if len(parts) < 9:
                    print(f"Warning: Line {line_num} has insufficient CPU data fields ({len(parts)} vs expected 9+)")
                    continue
                
                uid = int(parts[0])
                pid = int(parts[1])
                usr = float(parts[2])
                system = float(parts[3])
                guest = float(parts[4])
                wait = float(parts[5])
                cpu_percent = float(parts[6])
                cpu_core = int(float(parts[7]))  # Handle potential float values
                command = ' '.join(parts[8:])
                
                cpu_data.append({
                    'time': time_str,
                    'pid': pid,
                    'usr': usr,
                    'system': system,
                    'guest': guest,
                    'wait': wait,
                    'cpu_percent': cpu_percent,
                    'cpu_core': cpu_core,
                    'command': command.strip()
                })
            
            elif current_section == 'mem':
                # Expected format: UID PID minflt/s majflt/s VSZ RSS %MEM Command
                if len(parts) < 8:
                    print(f"Warning: Line {line_num} has insufficient memory data fields ({len(parts)} vs expected 8+)")
                    continue
                
                uid = int(parts[0])
                pid = int(parts[1])
                minflt = float(parts[2])
                majflt = float(parts[3])
                vsz = int(float(parts[4]))  # Handle potential float values
                rss = int(float(parts[5]))  # Handle potential float values
                mem_percent = float(parts[6])
                command = ' '.join(parts[7:])
                
                mem_data.append({
                    'time': time_str,
                    'pid': pid,
                    'minflt/s': minflt,
                    'majflt/s': majflt,
                    'VSZ': vsz,
                    'RSS': rss,
                    'mem_percent': mem_percent,
                    'command': command.strip()
                })
        
        except (ValueError, IndexError) as e:
            print(f"Warning: Failed to parse line {line_num} - {e}")
            print(f"  Line content: {line}")
            print(f"  Parts: {parts}")
            continue
    
    return cpu_data, mem_data

def calculate_statistics(cpu_df, mem_df):
    """
    Calculate resource usage statistics
    
    Args:
        cpu_df (DataFrame): CPU data DataFrame
        mem_df (DataFrame): Memory data DataFrame
        
    Returns:
        dict: Statistics dictionary
    """
    stats = {'cpu': {}, 'mem': {}}
    
    if not cpu_df.empty:
        stats['cpu'] = {
            'avg_cpu_percent': cpu_df['cpu_percent'].mean(),
            'max_cpu_percent': cpu_df['cpu_percent'].max(),
            'avg_usr': cpu_df['usr'].mean(),
            'max_usr': cpu_df['usr'].max(),
            'avg_system': cpu_df['system'].mean(),
            'max_system': cpu_df['system'].max(),
            'avg_wait': cpu_df['wait'].mean(),
            'max_wait': cpu_df['wait'].max(),
            'avg_guest': cpu_df['guest'].mean(),
            'max_guest': cpu_df['guest'].max(),
            'max_cpu_time': cpu_df.loc[cpu_df['cpu_percent'].idxmax(), 'time'] if not cpu_df.empty else '',
            'max_core_usage': cpu_df['cpu_core'].value_counts().idxmax() if not cpu_df.empty else 0
        }
    
    if not mem_df.empty:
        stats['mem'] = {
            'avg_mem_percent': mem_df['mem_percent'].mean(),
            'max_mem_percent': mem_df['mem_percent'].max(),
            'avg_rss': mem_df['RSS'].mean(),
            'max_rss': mem_df['RSS'].max(),
            'avg_vsz': mem_df['VSZ'].mean(),
            'max_vsz': mem_df['VSZ'].max(),
            'avg_minflt': mem_df['minflt/s'].mean(),
            'max_minflt': mem_df['minflt/s'].max(),
            'avg_majflt': mem_df['majflt/s'].mean(),
            'max_majflt': mem_df['majflt/s'].max(),
            'max_mem_time': mem_df.loc[mem_df['mem_percent'].idxmax(), 'time'] if not mem_df.empty else '',
            'max_rss_time': mem_df.loc[mem_df['RSS'].idxmax(), 'time'] if not mem_df.empty else ''
        }
    
    return stats

def plot_cpu_usage(cpu_df, output_prefix='cpu_usage'):
    """
    Plot CPU usage chart
    
    Args:
        cpu_df (DataFrame): CPU data DataFrame
        output_prefix (str): Output file prefix
    """
    if cpu_df.empty:
        print("Warning: No CPU data available, skipping plot")
        return
    
    # Convert time to datetime objects
    base_date = datetime(2025, 11, 14)  # Use date from log
    cpu_df['datetime'] = cpu_df['time'].apply(
        lambda x: base_date + timedelta(
            hours=int(x.split(':')[0]),
            minutes=int(x.split(':')[1]),
            seconds=int(x.split(':')[2])
        )
    )
    
    plt.figure(figsize=(14, 10))
    
    # CPU Usage Overview
    ax1 = plt.subplot(2, 1, 1)
    ax1.plot(cpu_df['datetime'], cpu_df['cpu_percent'], 'b-', linewidth=2.5, 
             label=f'Total CPU Usage (Avg: {cpu_df["cpu_percent"].mean():.1f}%)')
    ax1.plot(cpu_df['datetime'], cpu_df['usr'], 'g--', linewidth=2, 
             label=f'User Mode (Avg: {cpu_df["usr"].mean():.1f}%)')
    ax1.plot(cpu_df['datetime'], cpu_df['system'], 'r--', linewidth=2, 
             label=f'System Mode (Avg: {cpu_df["system"].mean():.1f}%)')
    ax1.plot(cpu_df['datetime'], cpu_df['wait'], 'y--', linewidth=2, 
             label=f'I/O Wait (Avg: {cpu_df["wait"].mean():.1f}%)')
    
    ax1.set_title('CPU Usage Monitoring', fontsize=16, fontweight='bold', pad=20)
    ax1.set_ylabel('CPU Usage (%)', fontsize=12)
    ax1.grid(True, alpha=0.3, linestyle='--')
    ax1.legend(loc='upper right', fontsize=10)
    
    # CPU Core Allocation
    ax2 = plt.subplot(2, 1, 2)
    ax2.plot(cpu_df['datetime'], cpu_df['cpu_core'], 'o-', color='purple', 
             linewidth=2, markersize=8, label=f'CPU Core (Most used: {cpu_df["cpu_core"].value_counts().idxmax()})')
    ax2.fill_between(cpu_df['datetime'], cpu_df['cpu_core'], alpha=0.2, color='purple')
    
    ax2.set_title('CPU Core Allocation', fontsize=16, fontweight='bold', pad=20)
    ax2.set_ylabel('CPU Core Number', fontsize=12)
    ax2.set_xlabel('Time', fontsize=12)
    ax2.grid(True, alpha=0.3, linestyle='--')
    ax2.legend(loc='upper right', fontsize=10)
    ax2.set_ylim(-0.5, cpu_df['cpu_core'].max() + 1)
    
    # Format x-axis
    for ax in [ax1, ax2]:
        ax.xaxis.set_major_formatter(mdates.DateFormatter('%H:%M:%S'))
        ax.xaxis.set_major_locator(mdates.AutoDateLocator())
        plt.setp(ax.xaxis.get_majorticklabels(), rotation=45, ha='right')
    
    plt.tight_layout()
    output_file = f'{output_prefix}.png'
    plt.savefig(output_file, dpi=300, bbox_inches='tight')
    print(f"âœ“ CPU chart generated: {output_file}")
    plt.close()

def plot_memory_usage(mem_df, output_prefix='memory_usage'):
    """
    Plot memory usage chart
    
    Args:
        mem_df (DataFrame): Memory data DataFrame
        output_prefix (str): Output file prefix
    """
    if mem_df.empty:
        print("Warning: No memory data available, skipping plot")
        return
    
    # Convert time to datetime objects
    base_date = datetime(2025, 11, 14)  # Use date from log
    mem_df['datetime'] = mem_df['time'].apply(
        lambda x: base_date + timedelta(
            hours=int(x.split(':')[0]),
            minutes=int(x.split(':')[1]),
            seconds=int(x.split(':')[2])
        )
    )
    
    plt.figure(figsize=(14, 12))
    
    # Memory Usage Percentage
    ax1 = plt.subplot(2, 1, 1)
    ax1.plot(mem_df['datetime'], mem_df['mem_percent'], 'b-', linewidth=3, 
             label=f'Memory Usage (Avg: {mem_df["mem_percent"].mean():.2f}%)')
    
    ax1.set_title('Memory Usage Monitoring', fontsize=16, fontweight='bold', pad=20)
    ax1.set_ylabel('Memory Usage (%)', fontsize=12)
    ax1.grid(True, alpha=0.3, linestyle='--')
    ax1.legend(loc='upper right', fontsize=10)
    
    # Memory Size (RSS vs VSZ)
    ax2 = plt.subplot(2, 1, 2)
    rss_mb = mem_df['RSS'] / 1024  # Convert to MB
    vsz_mb = mem_df['VSZ'] / 1024  # Convert to MB
    
    ax2.plot(mem_df['datetime'], rss_mb, 'g-', linewidth=2.5, 
             label=f'RSS Physical Memory (Avg: {rss_mb.mean():.1f} MB)')
    ax2.plot(mem_df['datetime'], vsz_mb, 'r-', linewidth=2.5, 
             label=f'VSZ Virtual Memory (Avg: {vsz_mb.mean():.1f} MB)')
    
    ax2.set_title('Memory Size Monitoring', fontsize=16, fontweight='bold', pad=20)
    ax2.set_ylabel('Memory Size (MB)', fontsize=12)
    ax2.set_xlabel('Time', fontsize=12)
    ax2.grid(True, alpha=0.3, linestyle='--')
    ax2.legend(loc='upper right', fontsize=10)
    
    # Format x-axis
    for ax in [ax1, ax2]:
        ax.xaxis.set_major_formatter(mdates.DateFormatter('%H:%M:%S'))
        ax.xaxis.set_major_locator(mdates.AutoDateLocator())
        plt.setp(ax.xaxis.get_majorticklabels(), rotation=45, ha='right')
    
    plt.tight_layout()
    output_file = f'{output_prefix}.png'
    plt.savefig(output_file, dpi=300, bbox_inches='tight')
    print(f"âœ“ Memory chart generated: {output_file}")
    plt.close()

def generate_report(stats, cpu_df, mem_df, output_file='resource_report.txt'):
    """
    Generate resource usage statistics report
    
    Args:
        stats (dict): Statistics dictionary
        cpu_df (DataFrame): CPU data DataFrame
        mem_df (DataFrame): Memory data DataFrame
        output_file (str): Output report filename
    """
    with open(output_file, 'w', encoding='utf-8') as f:
        f.write("=" * 60 + "\n")
        f.write("                    Resource Usage Statistics Report\n")
        f.write("=" * 60 + "\n\n")
        
        f.write(f"Report Generated: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n")
        f.write(f"Data Points Analyzed: CPU: {len(cpu_df)}, Memory: {len(mem_df)}\n")
        if not cpu_df.empty and not mem_df.empty:
            f.write(f"Process Analyzed: {cpu_df['command'].iloc[0]}\n")
        f.write("\n")
        
        if 'cpu' in stats and stats['cpu']:
            f.write("ğŸ“ˆ CPU USAGE STATISTICS:\n")
            f.write("-" * 60 + "\n")
            f.write(f"  Average CPU Usage:        {stats['cpu']['avg_cpu_percent']:6.2f}%\n")
            f.write(f"  Maximum CPU Usage:        {stats['cpu']['max_cpu_percent']:6.2f}%\n")
            f.write(f"  Average User Mode:        {stats['cpu']['avg_usr']:6.2f}%\n")
            f.write(f"  Maximum User Mode:        {stats['cpu']['max_usr']:6.2f}%\n")
            f.write(f"  Average System Mode:      {stats['cpu']['avg_system']:6.2f}%\n")
            f.write(f"  Maximum System Mode:      {stats['cpu']['max_system']:6.2f}%\n")
            f.write(f"  Average I/O Wait:         {stats['cpu']['avg_wait']:6.2f}%\n")
            f.write(f"  Maximum I/O Wait:         {stats['cpu']['max_wait']:6.2f}%\n")
            f.write(f"  Average Guest Mode:       {stats['cpu']['avg_guest']:6.2f}%\n")
            f.write(f"  Maximum Guest Mode:       {stats['cpu']['max_guest']:6.2f}%\n")
            f.write(f"  Most Used CPU Core:       {stats['cpu']['max_core_usage']}\n")
            f.write(f"  Peak CPU Usage Time:      {stats['cpu'].get('max_cpu_time', 'N/A')}\n\n")
        
        if 'mem' in stats and stats['mem']:
            f.write("ğŸ“Š MEMORY USAGE STATISTICS:\n")
            f.write("-" * 60 + "\n")
            f.write(f"  Average Memory Usage:     {stats['mem']['avg_mem_percent']:6.2f}%\n")
            f.write(f"  Maximum Memory Usage:     {stats['mem']['max_mem_percent']:6.2f}%\n")
            f.write(f"  Average RSS Memory:       {stats['mem']['avg_rss']/1024:6.2f} MB\n")
            f.write(f"  Maximum RSS Memory:       {stats['mem']['max_rss']/1024:6.2f} MB\n")
            f.write(f"  Average VSZ Memory:       {stats['mem']['avg_vsz']/1024:6.2f} MB\n")
            f.write(f"  Maximum VSZ Memory:       {stats['mem']['max_vsz']/1024:6.2f} MB\n")
            f.write(f"  Average Minor Page Faults:{stats['mem']['avg_minflt']:6.1f}/sec\n")
            f.write(f"  Maximum Minor Page Faults:{stats['mem']['max_minflt']:6.1f}/sec\n")
            f.write(f"  Average Major Page Faults:{stats['mem']['avg_majflt']:6.1f}/sec\n")
            f.write(f"  Maximum Major Page Faults:{stats['mem']['max_majflt']:6.1f}/sec\n")
            f.write(f"  Peak Memory Time:         {stats['mem'].get('max_mem_time', 'N/A')}\n")
            f.write(f"  Peak RSS Memory Time:     {stats['mem'].get('max_rss_time', 'N/A')}\n\n")
        
        f.write("=" * 60 + "\n")
        f.write("ANALYSIS NOTES:\n")
        f.write("-" * 60 + "\n")
        f.write("â€¢ CPU Usage = User Mode + System Mode + I/O Wait + Guest Mode\n")
        f.write("â€¢ RSS (Resident Set Size): Actual physical memory used by the process\n")
        f.write("â€¢ VSZ (Virtual Memory Size): Total virtual memory allocated to the process\n")
        f.write("â€¢ %MEM: Percentage of total physical memory used by the process\n")
        f.write("â€¢ Minor Page Faults: Page faults that didn't require disk I/O\n")
        f.write("â€¢ Major Page Faults: Page faults that required disk I/O\n")
        f.write("=" * 60 + "\n")
    
    print(f"âœ“ Statistics report generated: {output_file}")

def main():
    """
    Main function
    """
    if len(sys.argv) != 2:
        print("\n" + "=" * 60)
        print("                    PIDSTAT LOG ANALYSIS TOOL")
        print("=" * 60)
        print(f"\nUsage: {os.path.basename(sys.argv[0])} <pidstat_log_file_path>")
        print("\nExamples:")
        print(f"  {os.path.basename(sys.argv[0])} pidstat.log")
        print(f"  {os.path.basename(sys.argv[0])} /path/to/your/pidstat_output.log")
        print("\n" + "=" * 60)
        print("OUTPUT FILES:")
        print("  resource_report.txt - Detailed statistics report")
        print("  cpu_usage.png      - CPU usage visualization")
        print("  memory_usage.png   - Memory usage visualization")
        print("=" * 60 + "\n")
        sys.exit(1)
    
    log_file = sys.argv[1]
    
    print("\n" + "=" * 60)
    print("STARTING PIDSTAT LOG ANALYSIS")
    print("=" * 60)
    print(f"Log file: {log_file}")
    print(f"Start time: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
    print("-" * 60 + "\n")
    
    # Parse log
    cpu_data, mem_data = parse_pidstat_log(log_file)
    
    if not cpu_data and not mem_data:
        print("Error: No valid CPU or memory data parsed. Please check log file format")
        sys.exit(1)
    
    # Convert to DataFrames
    cpu_df = pd.DataFrame(cpu_data) if cpu_data else pd.DataFrame()
    mem_df = pd.DataFrame(mem_data) if mem_data else pd.DataFrame()
    
    print(f"âœ… PARSING COMPLETED SUCCESSFULLY")
    print(f"   â€¢ CPU data points: {len(cpu_df)}")
    print(f"   â€¢ Memory data points: {len(mem_df)}")
    if not cpu_df.empty:
        print(f"   â€¢ Process name (CPU): {cpu_df['command'].iloc[0]}")
    if not mem_df.empty:
        print(f"   â€¢ Process name (Memory): {mem_df['command'].iloc[0]}")
    print()
    
    # Calculate statistics
    stats = calculate_statistics(cpu_df, mem_df)
    
    # Generate report
    generate_report(stats, cpu_df, mem_df)
    
    # Plot charts
    if not cpu_df.empty:
        plot_cpu_usage(cpu_df)
    
    if not mem_df.empty:
        plot_memory_usage(mem_df)
    
    # Print summary
    print("\n" + "=" * 60)
    print("ğŸ“Š ANALYSIS SUMMARY")
    print("=" * 60)
    
    if not cpu_df.empty:
        print(f"CPU USAGE SUMMARY:")
        print(f"  â€¢ Average Total CPU: {stats['cpu']['avg_cpu_percent']:.2f}%")
        print(f"  â€¢ Maximum Total CPU: {stats['cpu']['max_cpu_percent']:.2f}%")
        print(f"  â€¢ Peak CPU Time: {stats['cpu'].get('max_cpu_time', 'N/A')}")
        print(f"  â€¢ Most Used Core: #{stats['cpu']['max_core_usage']}")
    
    if not mem_df.empty:
        print(f"\nMEMORY USAGE SUMMARY:")
        print(f"  â€¢ Average Memory Usage: {stats['mem']['avg_mem_percent']:.2f}%")
        print(f"  â€¢ Maximum Memory Usage: {stats['mem']['max_mem_percent']:.2f}%")
        print(f"  â€¢ Average RSS Memory: {stats['mem']['avg_rss']/1024:.2f} MB")
        print(f"  â€¢ Maximum RSS Memory: {stats['mem']['max_rss']/1024:.2f} MB")
        print(f"  â€¢ Peak Memory Time: {stats['mem'].get('max_mem_time', 'N/A')}")
    
    print(f"\nFILES GENERATED:")
    print(f"  â€¢ resource_report.txt")
    print(f"  â€¢ cpu_usage.png")
    print(f"  â€¢ memory_usage.png")
    
    print("\n" + "=" * 60)
    print("ANALYSIS COMPLETED SUCCESSFULLY!")
    print(f"End time: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
    print("=" * 60)

if __name__ == "__main__":
    main()
```